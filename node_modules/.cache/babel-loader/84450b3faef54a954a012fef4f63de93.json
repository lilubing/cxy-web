{"remainingRequest":"/Users/work/webworkspace/cxy-web/node_modules/babel-loader/lib/index.js!/Users/work/webworkspace/cxy-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/work/webworkspace/cxy-web/src/store/modules/permission.js","dependencies":[{"path":"/Users/work/webworkspace/cxy-web/src/store/modules/permission.js","mtime":1610690349290},{"path":"/Users/work/webworkspace/cxy-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/work/webworkspace/cxy-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/work/webworkspace/cxy-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIi9Vc2Vycy93b3JrL3dlYndvcmtzcGFjZS9jeHktd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IHsgYXN5bmNSb3V0ZXMsIGNvbnN0YW50Um91dGVzIH0gZnJvbSAnQC9yb3V0ZXInOwppbXBvcnQgeyBnZXRNZW51UGVyIH0gZnJvbSAnQC9hcGkvbG9naW4nOwovKioKICogVXNlIG1ldGEucm9sZSB0byBkZXRlcm1pbmUgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgcGVybWlzc2lvbgogKiBAcGFyYW0gcm9sZXMKICogQHBhcmFtIHJvdXRlCiAqLwoKZnVuY3Rpb24gaGFzUGVybWlzc2lvbihyb2xlcywgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLnJvbGVzKSB7CiAgICByZXR1cm4gcm9sZXMuc29tZShmdW5jdGlvbiAocm9sZSkgewogICAgICByZXR1cm4gcm91dGUubWV0YS5yb2xlcy5pbmNsdWRlcyhyb2xlKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqCiAqIEZpbHRlciBhc3luY2hyb25vdXMgcm91dGluZyB0YWJsZXMgYnkgcmVjdXJzaW9uCiAqIEBwYXJhbSByb3V0ZXMgYXN5bmNSb3V0ZXMKICogQHBhcmFtIHJvbGVzCiAqLwoKCmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJBc3luY1JvdXRlcyhyb3V0ZXMsIHJvbGVzKSB7CiAgdmFyIHJlcyA9IFtdOwogIHJvdXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChyb3V0ZSkgewogICAgdmFyIHRtcCA9IF9vYmplY3RTcHJlYWQoe30sIHJvdXRlKTsKCiAgICBpZiAoaGFzUGVybWlzc2lvbihyb2xlcywgdG1wKSkgewogICAgICBpZiAodG1wLmNoaWxkcmVuKSB7CiAgICAgICAgdG1wLmNoaWxkcmVuID0gZmlsdGVyQXN5bmNSb3V0ZXModG1wLmNoaWxkcmVuLCByb2xlcyk7CiAgICAgIH0KCiAgICAgIHJlcy5wdXNoKHRtcCk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlczsKfQp2YXIgc3RhdGUgPSB7CiAgcm91dGVzOiBbXSwKICBhZGRSb3V0ZXM6IFtdCn07CnZhciBtdXRhdGlvbnMgPSB7CiAgU0VUX1JPVVRFUzogZnVuY3Rpb24gU0VUX1JPVVRFUyhzdGF0ZSwgcm91dGVzKSB7CiAgICBzdGF0ZS5hZGRSb3V0ZXMgPSByb3V0ZXM7CiAgICBzdGF0ZS5yb3V0ZXMgPSBjb25zdGFudFJvdXRlcy5jb25jYXQocm91dGVzKTsKICB9Cn07CgpmdW5jdGlvbiBsb29wUm91dGVzKGEsIHRlbXApIHsKICBhc3luY1JvdXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7CiAgICBiLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHsKICAgICAgaWYgKGMubWV0YS5tZW51SWQgPT09IGEucGVybWlzc2lvbl9pZCkgewogICAgICAgIHRlbXAuZm9yRWFjaChmdW5jdGlvbiAoZCkgewogICAgICAgICAgaWYgKGQubWV0YS5wYXJlbnRJZCA9PT0gYi5tZXRhLnBhcmVudElkKSB7CiAgICAgICAgICAgIGQuY2hpbGRyZW4ucHVzaChjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSk7Cn0KCnZhciBhY3Rpb25zID0gewogIGdlbmVyYXRlUm91dGVzOiBmdW5jdGlvbiBnZW5lcmF0ZVJvdXRlcyhfcmVmLCByb2xlcykgewogICAgdmFyIGNvbW1pdCA9IF9yZWYuY29tbWl0OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgZ2V0TWVudVBlcihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VySWQnKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgcGVybWlzc2lvblBhZ2UgPSByZXNwb25zZS5kYXRhOwogICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICB2YXIgdGVtcCA9IGFzeW5jUm91dGVzLm1hcChmdW5jdGlvbiAobikgewogICAgICAgICAgdmFyIG9iaiA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBuKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09ICdjaGlsZHJlbicpIHsKICAgICAgICAgICAgICBvYmpba2V5XSA9IG5ba2V5XTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8g5bCG5rKh5pyJbWVudUlk55qE6I+c5Y2V55u05o6l5bGV56S65Ye65p2lCiAgICAgICAgICAgICAgICB2YXIgYXJyVGVtcCA9IFtdOwogICAgICAgICAgICAgICAgbi5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICAgICAgICBpZiAoIWNoaWxkLm1ldGEubWVudUlkKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyVGVtcC5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4gPSBhcnJUZW1wOwogICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0pOwogICAgICAgIHBlcm1pc3Npb25QYWdlLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIC8vIOWIpOaWreaYr+WQpuacieWtkOiKgueCuQogICAgICAgICAgaWYgKHVuZGVmaW5lZCAhPT0gYS5jaGlsZHJlbikgewogICAgICAgICAgICBhLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAvLyDms6jmhI/vvJrov5nph4zmsqHmnInlhpnkuoznuqfoj5zljZXnmoTlrZDoj5zljZUKICAgICAgICAgICAgICBsb29wUm91dGVzKGUsIHRlbXApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBsb29wUm91dGVzKGEsIHRlbXApOwogICAgICAgIH0pOyAvLyDliKDpmaRjaGlsZHJlbiDplb/luqbkuLowIOeahOWvueixoQoKICAgICAgICB0ZW1wLmZvckVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIGlmIChuLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2gobik7CiAgICAgICAgICB9CiAgICAgICAgfSk7IC8vIHJlc3VsdCA9IGNvbnN0YW50Um91dGVzLmNvbmNhdChyZXN1bHQpCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3Jlc3VsdD0nICsgcmVzdWx0KQogICAgICAgIC8vIHN0YXRlLmFkZFJvdXRlcnMgPSByZXN1bHQKCiAgICAgICAgdmFyIGFjY2Vzc2VkUm91dGVzID0gZmlsdGVyQXN5bmNSb3V0ZXMocmVzdWx0LCByb2xlcyk7CiAgICAgICAgY29tbWl0KCdTRVRfUk9VVEVTJywgYWNjZXNzZWRSb3V0ZXMpOwogICAgICAgIHJlc29sdmUoYWNjZXNzZWRSb3V0ZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICB9KTsKICAgIH0pOwogIH0KfTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWVzcGFjZWQ6IHRydWUsCiAgc3RhdGU6IHN0YXRlLAogIG11dGF0aW9uczogbXV0YXRpb25zLAogIGFjdGlvbnM6IGFjdGlvbnMKfTs="},{"version":3,"sources":["/Users/work/webworkspace/cxy-web/src/store/modules/permission.js"],"names":["asyncRoutes","constantRoutes","getMenuPer","hasPermission","roles","route","meta","some","role","includes","filterAsyncRoutes","routes","res","forEach","tmp","children","push","state","addRoutes","mutations","SET_ROUTES","concat","loopRoutes","a","temp","b","c","menuId","permission_id","d","parentId","actions","generateRoutes","commit","Promise","resolve","reject","sessionStorage","getItem","then","response","permissionPage","data","result","map","n","obj","key","arrTemp","child","undefined","e","length","accessedRoutes","catch","error","namespaced"],"mappings":"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","sourcesContent":["import { asyncRoutes, constantRoutes } from '@/router'\nimport { getMenuPer } from '@/api/login'\n\n/**\n * Use meta.role to determine if the current user has permission\n * @param roles\n * @param route\n */\nfunction hasPermission(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return roles.some(role => route.meta.roles.includes(role))\n  } else {\n    return true\n  }\n}\n\n/**\n * Filter asynchronous routing tables by recursion\n * @param routes asyncRoutes\n * @param roles\n */\nexport function filterAsyncRoutes(routes, roles) {\n  const res = []\n  routes.forEach(route => {\n    const tmp = { ...route }\n    if (hasPermission(roles, tmp)) {\n      if (tmp.children) {\n        tmp.children = filterAsyncRoutes(tmp.children, roles)\n      }\n      res.push(tmp)\n    }\n  })\n\n  return res\n}\n\nconst state = {\n  routes: [],\n  addRoutes: []\n}\n\nconst mutations = {\n  SET_ROUTES: (state, routes) => {\n    state.addRoutes = routes\n    state.routes = constantRoutes.concat(routes)\n  }\n}\n\nfunction loopRoutes(a, temp) {\n  asyncRoutes.forEach(b => {\n    b.children.forEach(c => {\n      if (c.meta.menuId === a.permission_id) {\n        temp.forEach(d => {\n          if (d.meta.parentId === b.meta.parentId) {\n            d.children.push(c)\n          }\n        })\n      }\n    })\n  })\n}\n\nconst actions = {\n  generateRoutes({ commit }, roles) {\n    return new Promise((resolve, reject) => {\n      getMenuPer(sessionStorage.getItem('userId')).then(response => {\n        const permissionPage = response.data\n        var result = []\n\n        var temp = asyncRoutes.map(n => {\n          const obj = {}\n          for (const key in n) {\n            if (key !== 'children') {\n              obj[key] = n[key]\n            } else {\n              // 将没有menuId的菜单直接展示出来\n              const arrTemp = []\n              n.children.forEach(child => {\n                if (!child.meta.menuId) {\n                  arrTemp.push(child)\n                }\n              })\n              obj.children = arrTemp\n            }\n          }\n          return obj\n        })\n        permissionPage.forEach(a => {\n          // 判断是否有子节点\n          if (undefined !== a.children) {\n            a.children.forEach(e => {\n              // 注意：这里没有写二级菜单的子菜单\n              loopRoutes(e, temp)\n            })\n          }\n          loopRoutes(a, temp)\n        })\n        // 删除children 长度为0 的对象\n        temp.forEach(n => {\n          if (n.children.length > 0) {\n            result.push(n)\n          }\n        })\n        // result = constantRoutes.concat(result)\n        // console.log('result=' + result)\n        // state.addRouters = result\n        const accessedRoutes = filterAsyncRoutes(result, roles)\n        commit('SET_ROUTES', accessedRoutes)\n        resolve(accessedRoutes)\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  mutations,\n  actions\n}\n"]}]}