{"remainingRequest":"/Users/work/webworkspace/cxy-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/work/webworkspace/cxy-web/src/views/system/role/AuthForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/work/webworkspace/cxy-web/src/views/system/role/AuthForm.vue","mtime":1611017324525},{"path":"/Users/work/webworkspace/cxy-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/work/webworkspace/cxy-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/work/webworkspace/cxy-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/work/webworkspace/cxy-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldE1lbnVCdXR0b25zVHJlZUJ5Um9sZUlkLCBzZXRSb2xlQXV0aG9yaXRpZXMgfSBmcm9tICdAL2FwaS9yb2xlJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdBdXRoRm9ybScsCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHZ1ZS9yZXF1aXJlLXByb3AtdHlwZXMKICBwcm9wczogWyd2aXNhYmxlJywgJ3JvbGVJZCddLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjaGVja2VkS2V5czogW10sCiAgICAgIGRhdGE6IFsvKiB7CiAgICAgICAgICAgICAgaWQ6IDEsCiAgICAgICAgICAgICAgbmFtZTogJ+ezu+e7n+euoeeQhicsCiAgICAgICAgICAgICAgaXNNZW51OnRydWUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgICAgICAgICBpZDogNCwKICAgICAgICAgICAgICAgIG5hbWU6ICfnlKjmiLfnrqHnkIYnLAogICAgICAgICAgICAgICAgaXNNZW51OnRydWUsCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3sKICAgICAgICAgICAgICAgICAgaWQ6IDksCiAgICAgICAgICAgICAgICAgIG5hbWU6ICfnlKjmiLfliKDpmaQnLAogICAgICAgICAgICAgICAgICBpc01lbnU6ZmFsc2UKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaWQ6IDEwLAogICAgICAgICAgICAgICAgICBuYW1lOiAn55So5oi35L+u5pS5JywKICAgICAgICAgICAgICAgICAgaXNNZW51OmZhbHNlCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0qL10sCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAnbmFtZScKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0QXV0aG9yaXRpZXMoKQogIH0sCiAgbWV0aG9kczogewogICAgaGFuZGxlU3VibWl0KCkgewogICAgICAvLyBmYWxzZSDmmK/lkKblj6rljIXlkKvlj7blrZDoioLngrkgICAgLy90cnVlIOaYr+WQpuWMheWQq+WNiumAieeKtuaAgeiKgueCuQogICAgICBjb25zdCBoYWxmVHJlZUtleXMgPSB0aGlzLiRyZWZzLnRyZWUuZ2V0SGFsZkNoZWNrZWRLZXlzKCkKICAgICAgY29uc29sZS5sb2coaGFsZlRyZWVLZXlzKQogICAgICBjb25zdCB0cmVlS2V5cyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkS2V5cygpCiAgICAgIHNldFJvbGVBdXRob3JpdGllcyh0aGlzLnJvbGVJZCwgaGFsZlRyZWVLZXlzLmNvbmNhdCh0cmVlS2V5cykpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIHRoaXMuaGFuZGxlQ2xvc2UoKQogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgICAgICAgbWVzc2FnZTogJ+adg+mZkOiuvue9ruaIkOWKnycsCiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICB9KQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCiAgICAgIH0pCiAgICB9LAogICAgZ2V0QXV0aG9yaXRpZXMoKSB7CiAgICAgIC8vIGNvbnN0IHRoYXQgPSB0aGlzCiAgICAgIGdldE1lbnVCdXR0b25zVHJlZUJ5Um9sZUlkKHRoaXMucm9sZUlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLmRhdGEgPSByZXNwb25zZS5kYXRhCiAgICAgICAgdGhpcy5nZXRBbGxDaGVja2VkS2V5cyhyZXNwb25zZS5kYXRhKQogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCiAgICAgIH0pCiAgICB9LAogICAgZ2V0QWxsQ2hlY2tlZEtleXMocmVzdWx0RGF0YSkgewogICAgICByZXN1bHREYXRhLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaWYgKHVuZGVmaW5lZCAhPT0gaXRlbS5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRLZXlzLnB1c2goaXRlbS5tZW51QnV0dG9uSWQpCiAgICAgICAgfQogICAgICAgIGlmICh1bmRlZmluZWQgIT09IGl0ZW0uY2hpbGRyZW4pIHsKICAgICAgICAgIHRoaXMuZ2V0QWxsQ2hlY2tlZEtleXMoaXRlbS5jaGlsZHJlbikKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgcmVuZGVyQ29udGVudChoLCB7IG5vZGUsIGRhdGEsIHN0b3JlIH0pIHsKICAgICAgcmV0dXJuICgKICAgICAgICA8c3BhbiBjbGFzcz0nY3VzdG9tLXRyZWUtbm9kZSc+CiAgICAgICAgICB7dGhpcy5pY29uQ2xhc3MoZGF0YS50eXBlKX0KICAgICAgICAgIDxzcGFuIHN0eWxlPSdtYXJnaW4tbGVmdDo1cHg7Jz57bm9kZS5sYWJlbH08L3NwYW4+CiAgICAgICAgPC9zcGFuPgogICAgICApCiAgICB9LAogICAgaWNvbkNsYXNzKHR5cGUpIHsKICAgICAgaWYgKHR5cGUpIHsKICAgICAgICByZXR1cm4gPGkgY2xhc3M9J2VsLWljb24tZG9jdW1lbnQnPjwvaT4KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gPGkgY2xhc3M9J2VsLWljb24tbWVudSc+PC9pPgogICAgICB9CiAgICB9LAogICAgaGFuZGxlQ2hlY2tDaGFuZ2UoZGF0YSwgY2hlY2tlZCwgaW5kZXRlcm1pbmF0ZSkgewogICAgICBzZXRSb2xlQXV0aG9yaXRpZXMoZGF0YS5tZW51QnV0dG9uSWQsIGNoZWNrZWQsIHRoaXMucm9sZUlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgIHNob3dDbG9zZTogdHJ1ZSwKICAgICAgICAgIG1lc3NhZ2U6ICfmnYPpmZDorr7nva7miJDlip8nLAogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQogICAgICB9KQogICAgfSwKICAgIGhhbmRsZUNsb3NlKCkgewogICAgICB0aGlzLiRlbWl0KCdoYW5kbGVBdXRoSGlkZScpCiAgICB9LAogICAgaGFuZGxlUmVzZXQoKSB7CiAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkS2V5cyhbXSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["AuthForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AuthForm.vue","sourceRoot":"src/views/system/role","sourcesContent":["<template>\n  <el-dialog\n    title=\"权限控制\"\n    :visible=\"visable\"\n    width=\"30%\"\n    :modal=\"false\"\n    :before-close=\"handleClose\"\n  >\n    <el-tree\n      ref=\"tree\"\n      default-expand-all\n      :data=\"data\"\n      show-checkbox\n      node-key=\"menuButtonId\"\n      :default-checked-keys=\"checkedKeys\"\n      :props=\"defaultProps\"\n      highlight-current\n      :check-strictly=\"true\"\n      :render-content=\"renderContent\"\n      @check-change=\"handleCheckChange\"\n    />\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"handleReset\">重 置</el-button>\n      <el-button type=\"primary\" @click=\"handleClose\">关 闭</el-button>\n      <!-- <el-button type=\"primary\" @click=\"handleSubmit('form')\">确 定</el-button> -->\n    </span>\n  </el-dialog>\n</template>\n\n<script>\nimport { getMenuButtonsTreeByRoleId, setRoleAuthorities } from '@/api/role'\n\nexport default {\n  name: 'AuthForm',\n  // eslint-disable-next-line vue/require-prop-types\n  props: ['visable', 'roleId'],\n  data() {\n    return {\n      checkedKeys: [],\n      data: [/* {\n              id: 1,\n              name: '系统管理',\n              isMenu:true,\n              children: [{\n                id: 4,\n                name: '用户管理',\n                isMenu:true,\n                children: [{\n                  id: 9,\n                  name: '用户删除',\n                  isMenu:false\n                }, {\n                  id: 10,\n                  name: '用户修改',\n                  isMenu:false\n                }]\n              }]\n            }*/],\n      defaultProps: {\n        children: 'children',\n        label: 'name'\n      }\n    }\n  },\n  created() {\n    this.getAuthorities()\n  },\n  methods: {\n    handleSubmit() {\n      // false 是否只包含叶子节点    //true 是否包含半选状态节点\n      const halfTreeKeys = this.$refs.tree.getHalfCheckedKeys()\n      console.log(halfTreeKeys)\n      const treeKeys = this.$refs.tree.getCheckedKeys()\n      setRoleAuthorities(this.roleId, halfTreeKeys.concat(treeKeys)).then(response => {\n        this.handleClose()\n        this.$message({\n          showClose: true,\n          message: '权限设置成功',\n          type: 'success'\n        })\n      }).catch(error => {\n        console.log(error)\n      })\n    },\n    getAuthorities() {\n      // const that = this\n      getMenuButtonsTreeByRoleId(this.roleId).then(response => {\n        this.data = response.data\n        this.getAllCheckedKeys(response.data)\n      }).catch(error => {\n        console.log(error)\n      })\n    },\n    getAllCheckedKeys(resultData) {\n      resultData.forEach(item => {\n        if (undefined !== item.checked) {\n          this.checkedKeys.push(item.menuButtonId)\n        }\n        if (undefined !== item.children) {\n          this.getAllCheckedKeys(item.children)\n        }\n      })\n    },\n    renderContent(h, { node, data, store }) {\n      return (\n        <span class='custom-tree-node'>\n          {this.iconClass(data.type)}\n          <span style='margin-left:5px;'>{node.label}</span>\n        </span>\n      )\n    },\n    iconClass(type) {\n      if (type) {\n        return <i class='el-icon-document'></i>\n      } else {\n        return <i class='el-icon-menu'></i>\n      }\n    },\n    handleCheckChange(data, checked, indeterminate) {\n      setRoleAuthorities(data.menuButtonId, checked, this.roleId).then(response => {\n        this.$message({\n          showClose: true,\n          message: '权限设置成功',\n          type: 'success'\n        })\n      }).catch(error => {\n        console.log(error)\n      })\n    },\n    handleClose() {\n      this.$emit('handleAuthHide')\n    },\n    handleReset() {\n      this.$refs.tree.setCheckedKeys([])\n    }\n  }\n}\n</script>\n\n<style scoped>\n  .custom-tree-node {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    font-size: 14px;\n    padding-right: 8px;\n  }\n</style>\n"]}]}